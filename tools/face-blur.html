<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Blur Tool | Tools Hub</title>

    <!--
    ============================================
    FACE BLUR TOOL v1.0
    ============================================

    Privacy Notice: All image processing is performed locally in your browser.
    No images are uploaded to any server.

    Third-Party Libraries:
    - MediaPipe Face Detection (Apache License 2.0)
      https://github.com/google/mediapipe
    - Camera Utils (Apache License 2.0)
      https://github.com/google/mediapipe
    - Drawing Utils (Apache License 2.0)
      https://github.com/google/mediapipe

    License: GPL-3.0
    ============================================
    -->

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Shared CSS -->
    <link rel="stylesheet" href="../css/shared.css">

    <!-- Face Blur Tool CSS -->
    <link rel="stylesheet" href="../css/face_blurrer/face_blur.css">

    <!-- MediaPipe Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>

</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-left">
                    <a href="../tools.html" class="back-link">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"/>
                            <polyline points="12 19 5 12 12 5"/>
                        </svg>
                        Back to Tools
                    </a>
                </div>
                <div class="header-right">
                    <div class="theme-toggle">
                        <button data-theme-toggle="light" aria-pressed="false" title="Light mode">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5"/>
                                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                            </svg>
                        </button>
                        <button data-theme-toggle="dark" aria-pressed="false" title="Dark mode">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div style="margin-top: 24px; display: flex; align-items: center; gap: 16px;">
                <div class="tool-icon-header general">üõ°Ô∏è</div>
                <div>
                    <h1>Face Blur Tool</h1>
                    <p class="tagline">// PRIVACY ‚Ä¢ FACE DETECTION ‚Ä¢ BLUR ANONYMIZATION</p>
                </div>
            </div>
        </header>

        <main class="calculator-layout">
            <!-- Left Panel: Controls -->
            <aside class="calculator-panel">
                <div class="panel-header">
                    <h2>Face Blur Tool</h2>
                    <p>Detect and blur faces in images or video feed</p>
                </div>

                <!-- Privacy Notice -->
                <div class="privacy-banner">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    <div>
                        <strong>100% Privacy Focused</strong><br>
                        All processing happens in your browser.<br>
                        No images are ever uploaded.
                    </div>
                </div>

                <!-- Reversibility Warning -->
                <div class="reversibility-warning collapsed" id="reversibilityWarning">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    <div>
                        <strong>Blur Reversibility Warning</strong>
                        <button class="warning-toggle" onclick="toggleWarningDetails()">Show details</button>
                        <div class="warning-details">
                            Blur effects may be reversible using AI reconstruction tools. For sensitive content:
                            <br>‚Ä¢ Use maximum blur intensity (100%)
                            <br>‚Ä¢ Use "Pixelate" or "Black Box" for stronger obscuration
                            <br>‚Ä¢ Consider that multiple images of the same person can still enable identification
                        </div>
                    </div>
                </div>

                <!-- Input Type Selection -->
                <div class="section">
                    <div class="section-title">Input Source</div>
                    <div class="input-type-selector">
                        <button class="input-type-btn active" data-type="image" onclick="setInputType('image')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                            Image
                        </button>
                        <button class="input-type-btn" data-type="camera" onclick="setInputType('camera')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                <circle cx="12" cy="13" r="4"/>
                            </svg>
                            Camera
                        </button>
                    </div>
                </div>

                <!-- Image Upload Zone -->
                <div class="section" id="uploadSection">
                    <div class="upload-zone" id="uploadZone" onclick="document.getElementById('imageInput').click()">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <div class="upload-text">Click to upload image</div>
                        <div class="upload-hint">or drag and drop (JPG, PNG, WebP)</div>
                        <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">
                    </div>
                </div>

                <!-- Camera Section -->
                <div class="section" id="cameraSection" style="display: none;">
                    <button class="tool-btn" onclick="startCamera()" id="startCameraBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="23 7 16 12 23 17 23 7"/>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                        </svg>
                        Start Camera
                    </button>
                    <button class="tool-btn" onclick="stopCamera()" id="stopCameraBtn" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="6" y="4" width="4" height="16"/>
                            <rect x="14" y="4" width="4" height="16"/>
                        </svg>
                        Stop Camera
                    </button>
                    <button class="tool-btn" onclick="captureFrame()" id="captureBtn" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        Capture Frame
                    </button>
                </div>

                <!-- Blur Settings -->
                <div class="section">
                    <div class="section-title">Settings</div>

                    <div class="control-group">
                        <div class="control-label" style="display: flex; justify-content: space-between;">
                            <span>Intensity</span>
                            <span class="range-value" id="blurValueDisplay">50%</span>
                        </div>
                        <input type="range" class="range-slider" id="blurIntensity" min="1" max="100" value="50" oninput="updateBlurIntensity(this.value)">
                    </div>

                    <div class="control-group">
                        <div class="control-label" style="display: flex; justify-content: space-between;">
                            <span>Region Expansion</span>
                            <span class="range-value" id="expandValueDisplay">100%</span>
                        </div>
                        <input type="range" class="range-slider" id="expandRegion" min="50" max="200" value="100" oninput="updateExpandRegion(this.value)">
                    </div>

                    <div class="control-group">
                        <div class="control-label" style="display: flex; justify-content: space-between;">
                            <span>Detection Confidence</span>
                            <span class="range-value" id="confidenceValueDisplay">50%</span>
                        </div>
                        <input type="range" class="range-slider" id="confidenceThreshold" min="10" max="99" value="50" oninput="updateConfidence(this.value)">
                    </div>

                    <!-- Identity Protection Score -->
                    <div class="identity-score-card" id="identityScoreCard">
                        <div class="identity-score-header">
                            <span class="identity-score-title">Identity Protection</span>
                            <span class="identity-score-value" id="identityScoreValue">--</span>
                        </div>
                        <div class="identity-score-bar">
                            <div class="identity-score-fill" id="identityScoreFill"></div>
                        </div>
                        <div class="identity-score-breakdown" id="identityScoreBreakdown">
                            <span class="score-breakdown-item">Upload an image to analyze</span>
                        </div>
                    </div>

                <!-- Privacy Presets -->
                <div class="section">
                    <div class="section-title">Privacy Presets</div>
                    <div class="presets-grid">
                        <button class="preset-btn" onclick="applyPreset('journalist')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2z"/>
                                <path d="M2 6h20"/>
                                <path d="M12 11h.01"/>
                                <path d="M8 11h.01"/>
                                <path d="M16 11h.01"/>
                            </svg>
                            Journalist
                        </button>
                        <button class="preset-btn" onclick="applyPreset('legal')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2z"/>
                                <path d="M2 6h20"/>
                                <path d="M12 11h.01"/>
                                <path d="M8 11h.01"/>
                                <path d="M16 11h.01"/>
                            </svg>
                            Legal
                        </button>
                        <button class="preset-btn" onclick="applyPreset('social')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v5h2V9a5 5 0 0 0 5 5h3"/>
                            </svg>
                            Social
                        </button>
                        <button class="preset-btn" onclick="applyPreset('maximum')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                            Maximum
                        </button>
                        <button class="preset-btn" onclick="applyPreset('inpaint')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v4"/>
                                <path d="M12 18v4"/>
                                <path d="M4.93 4.93l2.83 2.83"/>
                                <path d="M16.24 16.24l2.83 2.83"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            Inpaint
                        </button>
                    </div>
                </div>

                <!-- Feature Blurring -->
                <div class="section" id="featureBlurringSection" style="display: none;">
                    <div class="section-title">Feature Blurring</div>
                    <div class="feature-blur-controls">
                        <div class="feature-blur-item">
                            <label class="feature-blur-label">
                                <input type="checkbox" id="blurEyes" onchange="updateFeatureBlurring()" checked>
                                <span class="feature-toggle"></span>
                                Eyes
                            </label>
                        </div>
                        <div class="feature-blur-item">
                            <label class="feature-blur-label">
                                <input type="checkbox" id="blurEyebrows" onchange="updateFeatureBlurring()">
                                <span class="feature-toggle"></span>
                                Eyebrows
                            </label>
                        </div>
                        <div class="feature-blur-item">
                            <label class="feature-blur-label">
                                <input type="checkbox" id="blurNose" onchange="updateFeatureBlurring()">
                                <span class="feature-toggle"></span>
                                Nose
                            </label>
                        </div>
                        <div class="feature-blur-item">
                            <label class="feature-blur-label">
                                <input type="checkbox" id="blurMouth" onchange="updateFeatureBlurring()">
                                <span class="feature-toggle"></span>
                                Mouth
                            </label>
                        </div>
                    </div>
                </div>

                <div class="section-title" style="margin-top: 12px;">Blur Type</div>
                    <div class="blur-type-grid">
                        <button class="blur-type-btn active" data-type="gaussian" onclick="setBlurType('gaussian')">Gaussian</button>
                        <button class="blur-type-btn" data-type="pixelate" onclick="setBlurType('pixelate')">Pixelate</button>
                        <button class="blur-type-btn" data-type="mosaic" onclick="setBlurType('mosaic')">Mosaic</button>
                        <button class="blur-type-btn" data-type="box" onclick="setBlurType('box')">Black Box</button>
                        <button class="blur-type-btn" data-type="motion" onclick="setBlurType('motion')">Motion</button>
                        <button class="blur-type-btn" data-type="eyes" onclick="setBlurType('eyes')">Eyes Only</button>
                        <button class="blur-type-btn" data-type="inpaint" onclick="setBlurType('inpaint')">Inpaint</button>
                        <button class="blur-type-btn" data-type="skinmask" onclick="setBlurType('skinmask')">
                            Skin Mask
                            <span class="info-tooltip">
                                <svg class="info-tooltip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="12" y1="16" x2="12" y2="12"/>
                                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                                </svg>
                                <span class="info-tooltip-text">May miss some skin tones - works best on light/medium skin</span>
                            </span>
                        </button>
                        <button class="blur-type-btn" data-type="features" onclick="setBlurType('features')">Feature Destroyer</button>
                    </div>

                    <div class="toggle-container" style="margin-top: 12px;">
                        <span class="toggle-label">Show Face Boxes</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="showFaceBoxes" onchange="redrawImage()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="toggle-container">
                        <span class="toggle-label">Show Face Mesh</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="showFaceMesh" onchange="redrawImage()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="toggle-container">
                        <span class="toggle-label">Manual Draw Mode</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="manualDrawMode" onchange="toggleManualDraw()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Face List Panel -->
                <div class="face-list-panel" id="faceListPanel">
                    <div class="face-list-header">
                        <span class="face-list-title">Detected Faces</span>
                        <div class="face-list-actions">
                            <button class="face-list-btn" onclick="selectAllFaces(true)">Select All</button>
                            <button class="face-list-btn" onclick="selectAllFaces(false)">Deselect All</button>
                        </div>
                    </div>
                    <div class="face-list-items" id="faceListItems">
                        <!-- Face items will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="section">
                    <button class="tool-btn" onmousedown="showOriginal()" onmouseup="hideOriginal()" onmouseleave="hideOriginal()" ontouchstart="showOriginal()" ontouchend="hideOriginal()" id="previewBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        Hold to Preview (Space)
                    </button>
                    <button class="tool-btn primary" onclick="downloadImage()" id="downloadBtn" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Download Blurred Image
                    </button>
                    <button class="tool-btn" onclick="resetTool()" id="resetBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                        Reset
                    </button>
                    <button class="tool-btn" onclick="clearManualRegions()" id="clearManualBtn" style="display: none;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        Clear All Regions
                    </button>

                    <!-- Undo/Redo Buttons (shown in manual draw mode) -->
                    <div id="undoRedoContainer" style="display: none; gap: 8px;">
                        <button class="tool-btn" onclick="undoManualRegion()" id="undoBtn" disabled title="Undo (Ctrl+Z)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 7v6h6"/>
                                <path d="M3 13a9 9 0 1 0 3-7.7L3 7"/>
                            </svg>
                            Undo
                        </button>
                        <button class="tool-btn" onclick="redoManualRegion()" id="redoBtn" disabled title="Redo (Ctrl+Y)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 7v6h-6"/>
                                <path d="M21 13a9 9 0 1 1-3-7.7l3 2.7"/>
                            </svg>
                            Redo
                        </button>
                    </div>
                </div>

                <!-- Status Indicator -->
                <div class="status-indicator" id="statusIndicator">
                    <div class="spinner" id="statusSpinner"></div>
                    <span id="statusText">Processing...</span>
                </div>

                <!-- License Info -->
                <div class="license-info">
                    <strong>License Attribution:</strong><br>
                    Uses MediaPipe Face Detection (Apache 2.0)<br>
                    <a href="https://github.com/google/mediapipe" target="_blank">github.com/google/mediapipe</a>
                </div>
            </aside>

            <!-- Right Panel: Canvas Display -->
            <div class="canvas-container">
                <div class="canvas-wrapper" id="canvasWrapper">
                    <!-- Placeholder Content -->
                    <div class="placeholder-content" id="placeholderContent">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21 15 16 10 5 21"/>
                        </svg>
                        <p>Upload an image or start camera to begin<br>face detection and blur</p>
                    </div>

                    <!-- Canvas for image processing -->
                    <canvas id="outputCanvas"></canvas>

                    <!-- Comparison Canvas (for before/after slider) -->
                    <canvas id="comparisonCanvas" style="display: none;"></canvas>

                    <!-- Comparison Slider -->
                    <div class="comparison-slider" id="comparisonSlider" style="display: none;">
                        <div class="comparison-handle" id="comparisonHandle">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6"/>
                            </svg>
                        </div>
                        <div class="comparison-label-before">Before</div>
                        <div class="comparison-label-after">After</div>
                    </div>

                    <!-- Camera Video -->
                    <div class="camera-container" id="cameraContainer">
                        <video id="cameraVideo" autoplay playsinline style="display: none;"></video>
                        <canvas id="cameraCanvas"></canvas>
                    </div>

                    <!-- Face Count Badge -->
                    <div class="face-count-badge" id="faceCountBadge">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        <span id="faceCount">0</span> faces
                    </div>

                    <!-- Comparison Mode Toggle -->
                    <div class="comparison-toggle" id="comparisonToggle" style="display: none;">
                        <button class="comparison-btn active" id="showBlurredBtn" onclick="setComparisonMode('blurred')">Blurred</button>
                        <button class="comparison-btn" id="showSliderBtn" onclick="setComparisonMode('slider')">Compare</button>
                        <button class="comparison-btn" id="showOriginalBtn" onclick="setComparisonMode('original')">Original</button>
                    </div>
                </div>
            </div>
        </main>

        <footer data-footer></footer>
    </div>

    <!-- Shared JavaScript -->
    <script type="module" src="../js/shared.js"></script>
    <script type="module" src="../js/footer.js"></script>

    <!-- Face Blur Tool Scripts -->
    <script src="../js/face_blurrer/landmarks.js"></script>
    <script src="../js/face_blurrer/blur-algorithms.js"></script>
    <script src="../js/face_blurrer/face-blur.js"></script>
</body>
</html>
